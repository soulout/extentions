/*! (C) Copyright 2018 LanguageTooler GmbH. All rights reserved. */
class TweaksManager{static _anonymizeEmail(e){return e.replace(TweaksManager.EMAIL_DOMAIN_REG_EXP,"@replaced.domain").trim()}static _removeEmail(e){return e.replace(TweaksManager.EMAIL_REG_EXP,"").trim()}static _isElementCompatibleForGoogleServices(e){return!e.closest("uf-describe-page")&&this.DEFAULT_TWEAKS.isElementCompatible(e)}static getTweaks(e){function t(e,t,a=!1){Array.isArray(t)||(t=[t]);for(const n of t)if("string"==typeof n){if(e===n||a&&e.startsWith(n))return!0}else if(n.test(e))return!0;return!1}let a=null;try{a=new URL(e).hostname}catch(e){}if(!a)return TweaksManager.DEFAULT_TWEAKS;const n=getSubdomains(a),o=TweaksManager.SITE_TWEAKS.find(a=>"hostname"in a.match?n.some(e=>t(e,a.match.hostname)):"url"in a.match?t(e,a.match.url):void 0);return Object.assign({},TweaksManager.DEFAULT_TWEAKS,o)}}TweaksManager.NON_COMPATIBLE_TAGS=["TR","TH","TD","THEAD","TBODY","TFOOT","CAPTION"],TweaksManager.EMAIL_REG_EXP=/<?(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])>?/g,TweaksManager.EMAIL_DOMAIN_REG_EXP=/@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/g,TweaksManager.DEFAULT_TWEAKS={init(){document.documentElement.setAttribute("data-lt-installed","true")},supported:()=>!0,unsupportedMessage:()=>"",isElementCompatible(e){if(!(isInputArea(e)&&!e.readOnly))return!1;if(isTextInput(e))return!1;if(TweaksManager.NON_COMPATIBLE_TAGS.includes(e.tagName))return!1;if(e.closest("quill-editor"))return!1;if(e.classList.contains("cke_editable"))return!0;if(e.classList.contains("ve-ce-documentNode"))return!0;if(e.classList.contains("fr-element")&&!e.classList.contains("wsc-instance"))return!0;const t=e.ownerDocument;if(t.head&&isTinyMCE(e)){const a=t.createElement("script"),n="_isTinymceSpellcheckerActivated";return a.innerText=`\n                    try {\n                        if (window.parent.tinymce.get(document.body.dataset.id).plugins.tinymcespellchecker) {\n                            document.body.dataset.${n} = true;\n                        }\n                    } catch(e) {}\n                `,t.head.appendChild(a),a.remove(),!Boolean(e.dataset[n])}return!!(window.innerHeight>=20&&window.innerWidth>=100)&&("false"!==e.getAttribute("spellcheck")&&"false"!==e.getAttribute("data-lt"))},initElement:e=>({destroy(){}}),getParsingDetector(e){const t=document.body&&document.body.dataset&&document.body.dataset.id&&document.body.dataset.id.includes("ZmHtmlEditor");let a=location.href.includes("/owa/")||!!document.querySelector(".owa-font-compose");try{a=a||window.parent.location.href.includes("/owa/")||!!window.parent.document.querySelector(".owa-font-compose")}catch(e){}let n=!1;try{n=!!window.parent.document.title.match(/roundcube/i)||!!window.parent.location.href.match(/_action=compose/i)}catch(e){}return{isSignature:e=>t?!!(e.dataset&&e.dataset.marker&&e.dataset.marker.includes("_SIG_")):a?"signature"===e.id.toLowerCase():!!n&&"_rc_sig"===e.id,isQuote:e=>t?!!(e.dataset&&e.dataset.marker&&e.dataset.marker.includes("_QUOTED_")):!!a&&("divRplyFwdMsg"===e.id||!!e.previousElementSibling&&"divRplyFwdMsg"===e.previousElementSibling.id),isMention:()=>!1}},getRecipientInfo(e){try{const t="BODY"===e.tagName&&"tinymce"===e.id,a="TEXTAREA"===e.tagName&&"composebody"===e.id;if(t||a){const e=window.parent.document.getElementById("_from"),t=window.parent.document.getElementById("compose-subject"),a=window.parent.document.getElementById("_to");if(e&&t&&a){const e=TweaksManager._anonymizeEmail(a.value),t=TweaksManager._removeEmail(a.value);return Promise.resolve({address:e,fullName:t})}}}catch(e){}return Promise.resolve({address:"",fullName:""})},getHighlighterAppearance:e=>({getZIndex(e,t){let a=t.getStyle(e,"z-index");return(a=parseInt(a)||0)>0||t.isStackingContext(e)?a+1:null}}),getToolbarAppearance(e){const t=[Dialog.CONTAINER_ELEMENT_NAME,ErrorCard.CONTAINER_ELEMENT_NAME].join(", ");return{isVisible(e,t,a=32){let n=!0;n=isTextArea(e)||isTextInput(e)?!e.value.trim():!e.textContent.trim();const o=t.getPaddingBox(e);return!(n&&o.height<a)&&(o.width>=160&&o.height>=18)},getPosition(e,a,n,o=18){const i=e.ownerDocument.documentElement,r=e.ownerDocument.body;if(e===r)return{fixed:!0,left:i.clientWidth-a.width-6+"px"};const s=i.clientHeight,l=getVisibleTopAndBottom(e,n,s,t),c=l.bottom-l.top;if(c<o)return null;let m=n.getPaddingBox(e);if("IFRAME"===e.tagName){let t=null;try{t=e.contentWindow.document.documentElement}catch(e){}if(!t)return null;m.width=t.clientWidth,m.height=t.clientHeight,m.right=m.left+m.width,m.bottom=m.top+m.height}let g=m.top+l.bottom-6-a.height,p=m.right-6-a.width;if(c<=40){g=m.top+l.bottom-c/2-a.height/2}const d=m.height>=250,u=(i.scrollTop||r.scrollTop)+s;if(d&&m.top+l.bottom>=u&&m.top+a.height+12<u)return{fixed:!0,left:Math.round(p)+"px"};if(g>u)return null;const T=u-a.height-8;return g=Math.min(g,T),{fixed:!1,left:Math.round(p)+"px",top:Math.round(g)+"px"}}}},applyFix(e){const{error:t,replacementText:a,instance:n}=e;return n.inputAreaWrapper.replaceText(t.offset,t.length,a)},isClickIgnored:e=>!e.isTrusted},TweaksManager.SITE_TWEAKS=[{match:{hostname:["1und1.de","gmx.net","gmx.com","web.de"]},getParsingDetector:e=>({isSignature:e=>"string"==typeof e.className&&e.className.includes("signature"),isQuote:e=>"quote"===e.getAttribute("name"),isMention:()=>!1}),getRecipientInfo(e){try{const e=document.querySelector(".objectivation-address[title]")||window.parent.document.querySelector(".objectivation_name[title]");if(e){const t=(e.getAttribute("title")||"").replace(/"/g,""),a=TweaksManager._anonymizeEmail(t),n=TweaksManager._removeEmail(t);return Promise.resolve({address:a,fullName:n})}}catch(e){}return Promise.resolve({address:"",fullName:""})}},{match:{hostname:"mail.aol.com"},isElementCompatible:e=>e.classList.contains("contentEditDiv")&&"true"===e.getAttribute("contenteditable")||TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e),getParsingDetector:e=>({isSignature:e=>"clear:both"===e.getAttribute("style"),isQuote:e=>Boolean("DIV"===e.tagName&&e.previousElementSibling&&"BR"===e.previousElementSibling.tagName&&e.textContent&&e.textContent.startsWith("-----")),isMention:()=>!1})},{match:{hostname:"atlassian.net"},isElementCompatible:e=>!(!e.isContentEditable||!e.className.includes("ProseMirror"))||TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e),getHighlighterAppearance(){const e=location.href.match(/\/(wiki|projects|issues)\//);return{getZIndex(t,a){const n=TweaksManager.DEFAULT_TWEAKS.getHighlighterAppearance(t).getZIndex(t,a);return e&&t.classList.contains("ProseMirror")?(n||0)+1:n}}},getToolbarAppearance:e=>({isVisible:(e,t)=>e.className.includes("ProseMirror")||TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a)})},{match:{url:/\/jira\/|jira\./i},getHighlighterAppearance:()=>({getZIndex:(e,t)=>e.classList.contains("richeditor-cover")?null:TweaksManager.DEFAULT_TWEAKS.getHighlighterAppearance(e).getZIndex(e,t)})},{match:{url:/backoffice.*?\.check24\.de|mietwagen.*?\.check24\.de/},getParsingDetector(e){const t=/^\s*(dem erhalt von e-mails hinsichtlich|sie haben noch fragen|war diese e-mail hilfreich)/i;return{isSignature:e=>"TABLE"===e.tagName&&!!t.test(e.textContent),isQuote:e=>!1,isMention:()=>!1}}},{match:{hostname:"basecamp.com"},getToolbarAppearance(e){const t=document.querySelector(".chat__tools"),a=t?t.offsetWidth:0;return{isVisible:(e,t)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition(e,t,n){const o=TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,n);return o&&o.top&&o.left&&Object.assign(o,{left:parseInt(o.left)-a-8+"px",top:parseInt(o.top)-6+"px"}),o}}}},{match:{hostname:"canva.com"},isElementCompatible(e){const t=/rotate\([1-9\-]/;let a=e.closest("[style*=rotate]");for(;a&&a!==e.ownerDocument.body;){if(a.style.transform&&a.style.transform.match(t))return!1;a=a.parentElement&&a.parentElement.closest("[style*=rotate]")}return TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e)}},{match:{hostname:"clickfunnels.com"},supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("siteCannotBeSupported")},{match:{hostname:["onlinebanking.deutschebank.be","mabanque.bnpparibas"]},isElementCompatible:e=>!1},{match:{hostname:"deepl.com"},isElementCompatible:e=>!e.className.includes("target_textarea")&&TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e),applyFix(e){const t=TweaksManager.DEFAULT_TWEAKS.applyFix(e);return e.instance.inputAreaWrapper.simulateInput(e.replacementText),t}},{match:{hostname:"paper.dropbox.com"},getHighlighterAppearance:()=>({getZIndex(e,t){const a=TweaksManager.DEFAULT_TWEAKS.getHighlighterAppearance(e).getZIndex(e,t);return e.classList.contains("ace-editor")?(a||0)+1:a}}),getToolbarAppearance:e=>({isVisible:(e,t)=>!(e.offsetHeight<30&&e.classList.contains("editor-blank"))&&TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a)})},{match:{url:/www\.facebook\.com\/plugins\/feedback/},isElementCompatible:e=>"false"===e.getAttribute("spellcheck")&&"true"===e.getAttribute("contenteditable")||TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e)},{match:{hostname:["facebook.com","messenger.com"]},getToolbarAppearance(e){const t=!!e.closest(".fbDockWrapper");return{isVisible:(e,t)=>t.getPaddingBox(e).width>=120,getPosition(e,a,n){const o=TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,a,n,15);return o&&o.top&&t?Object.assign(o,{top:parseInt(o.top)-n.getDocumentScroll().top+"px",fixed:!0}):o}}}},{match:{hostname:/ads\.google\.com/},isElementCompatible:e=>!(!isTextInput(e)||!e.closest("[eta-headline], .headline-field-group, .long-headline-field, .description-field-group"))||TweaksManager._isElementCompatibleForGoogleServices(e),getToolbarAppearance(e){const t=!!e.closest("[eta-headline], .headline-field-group, .long-headline-field, .description-field-group")&&isTextInput(e);return{isVisible:(e,a)=>!!t||TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,a),getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a,15)}}},{match:{hostname:"chrome.google.com"},supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("webstoreSiteNotSupported")},{match:{hostname:"crowdsource.google.com"},isElementCompatible:e=>!(!isTextInput(e)||!e.closest("#question"))||TweaksManager._isElementCompatibleForGoogleServices(e),getToolbarAppearance(e){const t=isTextInput(e)&&!!e.closest("#question");return{isVisible:(e,a)=>t||TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,a),getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a)}}},{match:{hostname:"docs.google.com"},init(){function e(){return new Promise((e,t)=>{let a=0;const n=setInterval(()=>{document.querySelector("#docs-extensions-menu")?(clearInterval(n),e()):++a>20&&(clearInterval(n),t())},300)})}function t(){return new Promise((e,t)=>{let a=0;const n=setInterval(()=>{document.querySelector("#Mg84vN52USwkFhg4bBNx4d18SLOz3GMtV")?(clearInterval(n),e(!0)):++a>15&&(clearInterval(n),e(!1))},200)})}location.pathname.match(/\/document\/d\/.+/)&&window.parent===window&&new StorageController(a=>{e().then(()=>t()).then(e=>{if(browser.runtime.sendMessage({command:"SET_GOOGLE_DOCS_PLUGIN_STATE",value:e}),a.getUIState().hasSeenGoogleDocsTeaser)return;if(e)return;const t=document.createElement("lt-teaser"),n=document.createElement("lt-div");n.classList.add("lt-teaser__close"),n.addEventListener("click",()=>{a.updateUIState({hasSeenGoogleDocsTeaser:!0}),Tracker.trackEvent("Action","google_docs_teaser:close"),t.remove()},!0),t.append(n);const o=document.createElement("lt-div");o.classList.add("lt-teaser__headline"),o.textContent=browser.i18n.getMessage("googleDocsPluginTeaserHeadline"),t.append(o);const i=document.createElement("lt-div");i.classList.add("lt-teaser__text"),i.textContent=browser.i18n.getMessage("googleDocsPluginTeaserText"),t.append(i);const r=document.createElement("lt-div");r.classList.add("lt-teaser__button"),r.textContent=browser.i18n.getMessage("googleDocsPluginTeaserButton"),t.append(r),r.addEventListener("click",e=>{e.stopImmediatePropagation(),e.preventDefault(),a.updateUIState({hasSeenGoogleDocsTeaser:!0}),Tracker.trackEvent("Action","google_docs_teaser:click"),window.open("https://gsuite.google.com/marketplace/app/languagetool/805250893316?utm_medium=referral&utm_source=addon2","_blank"),t.remove()},!0),document.body.appendChild(t),Tracker.trackEvent("Action","google_docs_teaser:show")}).catch(()=>null)})},supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("googleDocsNotSupported","https://gsuite.google.com/marketplace/app/languagetool/805250893316?utm_medium=referral&utm_source=addon2")},{match:{hostname:"keep.google.com"},getToolbarAppearance:e=>({isVisible:(e,t)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition(e,t,a){const n=TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a);return"list item"===e.getAttribute("aria-label")&&n&&n.left&&(n.left=parseInt(n.left)-30+"px"),n}}),isElementCompatible:e=>TweaksManager._isElementCompatibleForGoogleServices(e)},{match:{hostname:"mail.google.com"},isElementCompatible:e=>e.matches(".editable[contenteditable=true]")||TweaksManager._isElementCompatibleForGoogleServices(e),initElement(e){const t=e=>{e.target instanceof Element&&e.target.closest("[aria-invalid=grammar], [aria-invalid=spelling]")&&e.stopImmediatePropagation()},a=()=>{const e=document.querySelectorAll("[data-overlay-action=spellreplace]");e&&Array.from(e).forEach(e=>{const t=e.closest(".pl");t&&t.remove()})};return e.addEventListener("keyup",a),e.addEventListener("click",t,!0),e.addEventListener("contextmenu",t,!0),e.setAttribute("data-lt-tweaks","gmail"),{destroy(){e.removeAttribute("data-lt-tweaks"),e.removeEventListener("keyup",a),e.removeEventListener("click",t,!0),e.removeEventListener("contextmenu",t,!0)}}},getParsingDetector:e=>({isSignature:t=>"string"==typeof t.className&&t.className.includes("gmail_signature")&&e.firstElementChild!==t,isQuote(t){const a=t.className;if("string"!=typeof a)return!1;if(a.includes("gmail_attr"))return!0;if(a.includes("gmail_quote")){if(e.firstElementChild===t)return!1;let a=!1;for(let e=0;e<t.children.length;e++){if("BLOCKQUOTE"===t.children[e].tagName){a=!0;break}}if(!a&&t.firstElementChild){if(t.firstElementChild.className.includes("gmail_attr"))return!0}}return!1},isMention:()=>!1}),getRecipientInfo(e){try{if("DIV"===e.tagName){const e=document.querySelector("input[name=to]");if(e){const t=TweaksManager._anonymizeEmail(e.value),a=TweaksManager._removeEmail(e.value);return Promise.resolve({address:t,fullName:a})}}}catch(e){}return Promise.resolve({address:"",fullName:""})}},{match:{url:/translate\.google\.[a-z]{2,3}(\.[a-z]{2,3})?\/community/},isElementCompatible:e=>!(!isTextInput(e)||!e.classList.contains("paper-input"))||TweaksManager._isElementCompatibleForGoogleServices(e),getToolbarAppearance(e){const t=isTextInput(e)&&e.classList.contains("paper-input");return{isVisible:(e,a)=>t||TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,a),getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a)}}},{match:{url:/translate\.google\.[a-z]{2,3}(\.[a-z]{2,3})?/},isElementCompatible:e=>"source"===e.id&&"TEXTAREA"===e.tagName||TweaksManager._isElementCompatibleForGoogleServices(e)},{match:{hostname:/google\.[a-z]{2,3}(\.[a-z]{2,3})?/},isElementCompatible:e=>TweaksManager._isElementCompatibleForGoogleServices(e)},{match:{hostname:["grammarly.com","gingersoftware.com","iblogbox.com","prowritingaid.com"]},supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("siteCannotBeSupported")},{match:{hostname:"languagetool.org"},isElementCompatible:e=>!e.classList.contains("mceContentBody")&&TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e)},{match:{hostname:["languagetoolplus.com","languagetool.com"]},init(){document.addEventListener("lt-upgrade",()=>{new StorageController(e=>{if(e.getUIState().hasPaidSubscription)return;Tracker.trackEvent("Action","upgrade"),e.checkForPaidSubscription().catch(e=>{Tracker.trackError("js",`Error checking paid subscripton: ${e&&e.message}`)});const{firstVisit:t}=e.getStatistics();if(t){const e=Math.floor((Date.now()-1e3*t)/1e3/60/60/24);Tracker.trackEvent("Action","upgrade:days_since_installation",`days:${e}`)}})}),document.addEventListener("lt-open-options",e=>{browser.runtime.sendMessage({command:"OPEN_OPTIONS",ref:"external"})});const e=document.querySelector("#lt-addon-user-token"),t=document.querySelector("#lt-addon-user-email");return e&&t&&new StorageController(a=>{if(Tracker.trackEvent("Action","auto_login:prepare"),a.isUsedCustomServer())return;const{havePremiumAccount:n,username:o}=a.getSettings();n?n&&t.value.toLowerCase()===o.toLowerCase()&&a.updateSettings({username:t.value,password:"",token:e.value}).then(()=>{a.checkForPaidSubscription().catch(e=>{Tracker.trackError("js",`Error checking paid subscripton: ${e&&e.message}`)})}):(a.updateSettings({havePremiumAccount:!0,username:t.value,password:"",token:e.value,knownEmail:t.value}).then(()=>{browser.runtime.sendMessage({command:"START_DICTIONARY_SYNC"}),a.checkForPaidSubscription().catch(e=>{Tracker.trackError("js",`Error checking paid subscripton: ${e&&e.message}`)})}),Tracker.trackEvent("Action","auto_login:success"))}),location.href.includes("/webextension/upgrade")&&new StorageController(e=>{const{premiumClicks:t}=e.getStatistics();e.updateStatistics({premiumClicks:t+1}),Tracker.trackEvent("Action","pricing_table:view")}),TweaksManager.DEFAULT_TWEAKS.init()},isElementCompatible:e=>!e.classList.contains("mceContentBody")&&TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e)},{match:{hostname:"linkedin.com"},getToolbarAppearance:e=>({isVisible:(e,t)=>!document.querySelector(".msg-form__hovercard.active")&&TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition(e,t,a){const n=e.nextElementSibling;if(isTextArea(e)&&n&&n.classList.contains("send-invite__count")&&n){const o=parseInt(a.getStyle(n,"width")),i=parseInt(a.getStyle(n,"right")),r=a.getBorderBox(e);return{fixed:!1,left:Math.round(r.right-i-o-4-t.width)+"px",top:Math.round(r.bottom-4-t.height)+"px"}}return TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a)}})},{match:{hostname:"liveworksheets.com"},getToolbarAppearance:e=>({isVisible(e,t){const a=t.getBorderBox(e);return a.width>=300&&a.height>=75},getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a)})},{match:{hostname:"e.mail.ru"},getRecipientInfo(e){try{const t="BODY"===e.tagName&&"tinymce"===e.id,a="TEXTAREA"===e.tagName&&e.classList.contains("composeEditor");if(t||a){const e=window.parent.document.getElementById("compose_to");if(e){const t=e.value.split(",")[0],a=TweaksManager._anonymizeEmail(t),n=TweaksManager._removeEmail(t);return Promise.resolve({address:a,fullName:n})}}}catch(e){}return Promise.resolve({address:"",fullName:""})}},{match:{url:/\/appsuite/},getParsingDetector:e=>({isSignature:e=>"string"==typeof e.className&&e.className.includes("ox-signature"),isQuote:e=>!1,isMention:()=>!1}),getRecipientInfo(e){try{const t="BODY"===e.tagName&&"tinymce"===e.id,a="TEXTAREA"===e.tagName&&e.parentElement&&e.parentElement.classList.contains("editor");if(t||a){const e=window.parent.document.querySelector(".tokenfield .token span.token-label");if(e){const t=e.textContent||"",a=TweaksManager._anonymizeEmail(t),n=TweaksManager._removeEmail(t);return Promise.resolve({address:a,fullName:n})}}}catch(e){}return Promise.resolve({address:"",fullName:""})}},{match:{hostname:"mytextarea.com"},getToolbarAppearance:e=>({isVisible:(e,t)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition(e,t,a){const n=TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a);return n&&n.left&&(n.left=parseInt(n.left)-25+"px"),n}})},{match:{hostname:"ondedrive.live.com"},supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("msOnlineOfficeNotSupported","https://appsource.microsoft.com/de-de/product/office/WA104381727")},{match:{url:/\/otrs/},getParsingDetector:e=>({isSignature:e=>!1,isQuote:e=>"cite"===e.getAttribute("type"),isMention:()=>!1})},{match:{hostname:"overleaf.com"},supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("siteCannotBeSupported")},{match:{hostname:["outlook.live.com","outlook.office365.com","outlook.office.com"]},getParsingDetector:e=>({isSignature:e=>"signature"===e.id.toLowerCase(),isQuote:e=>"divRplyFwdMsg"===e.id||!!e.previousElementSibling&&"divRplyFwdMsg"===e.previousElementSibling.id,isMention:()=>!1}),getRecipientInfo(e){try{if("DIV"===e.tagName&&"textbox"===e.getAttribute("role")){const t=document.querySelector(".ms-BasePicker-text [aria-label]");if(t){const e=t.getAttribute("aria-label")||"",a=TweaksManager._removeEmail(e);let n=TweaksManager._anonymizeEmail(e);return n.includes("@")||(n=`${a} <${a.split(" ").join(".").toLowerCase()}@replaced.domain>`),Promise.resolve({address:n,fullName:a})}const a=e.closest("._2BzYAu1OpUlMQyUR7PQGaZ");if(a){const e=a.querySelector("span.lpc-hoverTarget[role=button][aria-haspopup=dialog] li");if(e){const t=e.textContent||"",a=TweaksManager._removeEmail(t);let n=TweaksManager._anonymizeEmail(t);return n.includes("@")||(n=`${a} <${a.split(" ").join(".").toLowerCase()}@replaced.domain>`),Promise.resolve({address:n,fullName:a})}}}}catch(e){}return Promise.resolve({address:"",fullName:""})}},{match:{hostname:"prezi.com"},supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("siteCannotBeSupported")},{match:{hostname:"mail.protonmail.com"},getParsingDetector:e=>({isSignature:e=>"string"==typeof e.className&&e.className.includes("protonmail_signature"),isQuote:e=>!1,isMention:()=>!1})},{match:{hostname:"rambler.ru"},getRecipientInfo(e){try{if("BODY"===e.tagName&&"tinymce"===e.id){const e=window.parent.document.querySelector("div[class*=Fields-receiverWrapper] div[class*=Fields-inputWrapper] span[class*=EmailBadge-root] span[class*=EmailBadge-text]");if(e){const t=TweaksManager._anonymizeEmail(e.textContent||""),a=TweaksManager._removeEmail(e.textContent||"");return Promise.resolve({address:t,fullName:a})}}}catch(e){}return Promise.resolve({address:"",fullName:""})}},{match:{hostname:"reverso.net"},isElementCompatible:e=>"txtSource"===e.id&&"TEXTAREA"===e.tagName||TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e),getToolbarAppearance:e=>({isVisible:(e,t)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition(e,t,a){const n=TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a);return n&&n.top&&"txtSource"===e.id&&document.querySelector("#lnkSpeller:not(.bottom)")&&(n.top=parseInt(n.top)-28+"px"),n}})},{match:{hostname:"slack.com"},isElementCompatible(e){const t=e.parentElement;return!(!t||"focusable_search_input"===t.getAttribute("data-qa"))&&("message_input"===t.getAttribute("data-qa")||TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e))},getToolbarAppearance:e=>e.closest("[data-view-context='message-pane'], [data-view-context='threads-flexpane'], [data-qa='message_editor']")&&e.classList.contains("ql-editor")?{isVisible:e=>!0,getPosition(e,t,a){let n=parseInt(a.getStyle(e,"padding-top")),o=parseInt(a.getStyle(e,"padding-bottom"));const i=a.getBorderBox(e);n>0&&0===o&&(o=n,i.bottom+=n,i.height+=n);const r=Math.max(parseInt(a.getStyle(e,"padding-right"))+2,38),s=parseInt(a.getStyle(e,"line-height"))+n+o;return{fixed:!1,left:Math.round(i.right-r-t.width)+"px",top:Math.round(i.bottom-t.height+(t.height-s)/2)+"px"}}}:TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e),getParsingDetector:e=>({isSignature:e=>!1,isQuote:e=>!1,isMention:e=>"TS-MENTION"===e.tagName})},{match:{hostname:"my.smashdocs.net"},supported:()=>!1,unsupportedMessage:()=>browser.i18n.getMessage("siteCannotBeSupported")},{match:{hostname:"spanishdict.com"},isElementCompatible:e=>"query"!==e.id&&TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e)},{match:{hostname:"email.t-online.de"},getParsingDetector:e=>({isSignature:e=>!1,isQuote:e=>"P"===e.tagName&&e.textContent.trim().startsWith("-----Original-Nachricht"),isMention:()=>!1}),getRecipientInfo(e){try{const e=window.parent.document.querySelector(".multiObjectInputfield-object-text");if(e){const t=TweaksManager._removeEmail(e.textContent.trim()),a=TweaksManager._anonymizeEmail(e.getAttribute("title")||"");return Promise.resolve({address:`${t} <${a}>`,fullName:t})}}catch(e){}return Promise.resolve({address:"",fullName:""})}},{match:{hostname:"web.telegram.org"},getToolbarAppearance:e=>({isVisible:(e,t)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition(e,t,a){if(e.classList.contains("composer_rich_textarea")){let n=a.getPaddingBox(e),o=n.bottom-4-t.height,i=n.right-4-t.width;return{fixed:!1,left:Math.round(i)+"px",top:Math.round(o)+"px"}}return TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a)}})},{match:{hostname:"trello.com"},getToolbarAppearance:e=>({isVisible:(e,t)=>!document.querySelector(".pop-over.is-shown")&&TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a)})},{match:{hostname:"twitch.tv"},getToolbarAppearance(e){const t=e.getAttribute("data-a-target"),a="chat-input"===t,n="video-chat-input"===t;return{isVisible:(e,t)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition(e,t,o){const i=TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,o);if(a&&i&&i.left){const t=!(!e.parentElement||!e.parentElement.querySelector("[data-a-target=bits-button]"));return Object.assign(i,{left:parseInt(i.left)-(t?60:25)+"px"})}return n&&i&&i.left&&i.top?Object.assign(i,{left:parseInt(i.left)+3+"px",top:parseInt(i.top)+5+"px"}):i}}}},{match:{hostname:"twitter.com"},getToolbarAppearance:e=>({isVisible:(e,t)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t,20),getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a)})},{match:{hostname:"upwork.com"},getToolbarAppearance(e){const t=window.innerWidth>=768&&e.classList.contains("msg-composer-input");return{isVisible(e,t){const a=t.getBorderBox(e);return a.width>=160&&a.height>=19},getPosition(e,a,n){if(t){const t=-54,o=0,i=n.getBorderBox(e);return{fixed:!1,left:Math.round(i.right-t-a.width)+"px",top:Math.round(i.bottom-o-a.height)+"px"}}return TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,a,n)}}}},{match:{hostname:"vk.com"},getToolbarAppearance:e=>({isVisible(e,t){if("post_field"===e.id){const a=50;return t.getBorderBox(e).height>=a}return!e.classList.contains("page_status_input")&&TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t)},getPosition(e,t,a){const n=TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a);if(!n)return n;if(e.classList.contains("im_editable")||e.classList.contains("reply_field")){const t=parseInt(a.getStyle(e,"padding-right"));return Object.assign(n,{left:Math.round(parseInt(n.left)-t)+"px"})}return n}})},{match:{hostname:"web.whatsapp.com"},getToolbarAppearance:e=>({isVisible:(e,t)=>t.getPaddingBox(e).width>350||TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition:(e,t,a)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a)})},{match:{hostname:"mail.yahoo.com"},getParsingDetector:e=>({isSignature:e=>"string"==typeof e.className&&e.className.includes("signature"),isQuote:e=>"string"==typeof e.className&&e.className.includes("yahoo_quoted"),isMention:()=>!1}),getRecipientInfo(e){try{const e=document.querySelector("[data-test-id='email-pill'] [data-test-id='pill']");if(e)return Promise.resolve({address:TweaksManager._anonymizeEmail(e.getAttribute("title")||""),fullName:e.innerText.trim()})}catch(e){}return Promise.resolve({address:"",fullName:""})}},{match:{hostname:["mail.yandex.com","mail.yandex.ru","mail.yandex.uz","mail.yandex.lv","mail.yandex.ua","mail.yandex.co.il"]},getRecipientInfo(e){try{if("DIV"===e.tagName&&e.classList.contains("cke_wysiwyg_div")&&e.classList.contains("cke_editable")){const e=document.querySelector("div[name=to] span[bubble][data-yabble-email]");if(e){const t=TweaksManager._anonymizeEmail(e.dataset.yabbleName||""),a=TweaksManager._removeEmail(e.dataset.yabbleName||"");return Promise.resolve({address:t,fullName:a})}}}catch(e){}return Promise.resolve({address:"",fullName:""})},isClickIgnored(e){const t=e.target;return!!t&&isTextArea(t)&&"editor1"===t.id}},{match:{hostname:["translate.yandex.com","translate.yandex.ru","translate.yandex.uz","translate.yandex.lv","translate.yandex.ua","translate.yandex.co.il"]},isElementCompatible:e=>"fakeArea"===e.id&&e.isContentEditable||TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e)},{match:{hostname:["mail.zoho.com","mail.zoho.eu"]},getParsingDetector:e=>({isSignature:e=>e.id.startsWith("Zm-_Id_-Sgn"),isQuote:e=>e.classList.contains("zmail_extra"),isMention:()=>!1})},{match:{hostname:["social.zoho.com","social.zoho.eu"]},getToolbarAppearance:e=>({isVisible:(e,t)=>TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).isVisible(e,t),getPosition(e,t,a){const n=TweaksManager.DEFAULT_TWEAKS.getToolbarAppearance(e).getPosition(e,t,a);return n&&n.left&&e.classList.contains("inputBox")&&(n.left=parseInt(n.left)-26+"px"),n}})},{match:{hostname:"zybuluo.com"},isElementCompatible:e=>"TEXTAREA"===e.tagName&&"wmd-input"===e.id||TweaksManager.DEFAULT_TWEAKS.isElementCompatible(e)}];